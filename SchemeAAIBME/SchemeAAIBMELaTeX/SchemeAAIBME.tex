\documentclass[a4paper]{article}
\setlength{\parindent}{0pt}
\usepackage{amsmath,amssymb}
\usepackage{bm}

\begin{document}

\section{SchemeAAIBME}

\subsection{$\textbf{Setup}(n, d) \rightarrow (\textit{mpk}, \textit{msk})$}

$g \gets 1_{\mathbb{G}_1}$

generate $\alpha, \beta, t_1, t_2, t_3, t_4 \in \mathbb{Z}_r$ randomly

generate $g_2, g_3 \in \mathbb{G}_1$ randomly

generate $\bm{T} \gets (\bm{T}_0, \bm{T}_1, \cdots, \bm{T}_n) \in \mathbb{G}_1^{n + 1}$ randomly

generate $\bm{T}' \gets (\bm{T}'_0, \bm{T}'_1, \cdots, \bm{T}'_n) \in \mathbb{G}_1^{n + 1}$ randomly

generate $\bm{u} \gets (\bm{u}_0, \bm{u}_1, \cdots, \bm{u}_n) \in \mathbb{G_1}^{n + 1}$ randomly

generate $\bm{u}' \gets (\bm{u}'_0, \bm{u}'_1, \cdots, \bm{u}'_n) \in \mathbb{G}_1^{n + 1}$ randomly

$H_1: \{0, 1\}^* \rightarrow \mathbb{G}_1$

$g_1 \gets g^\alpha$

$g'_1 \gets g^\beta$

$Y_1 \gets e(g_1, g_2)^{t_1 t_2}$

$Y_2 \gets e(g_3, g)^\beta$

$v_1 \gets g^{t_1}$

$v_2 \gets g^{t_2}$

$v_3 \gets g^{t_3}$

$v_4 \gets g^{t_4}$

$ \textit{mpk} \gets (g_1, g'_1, g_2, g_3, Y_1, Y_2, v_1, v_2, v_3, v_4, \bm{u}, \bm{T}, \bm{u}', \bm{T}', H_1)$

$\textit{msk} \gets (g_2^\alpha, \beta, t_1, t_2, t_3, t_4)$

\textbf{return} $(\textit{mpk}, \textit{msk})$

\subsection{$\textbf{EKGen}(\textit{ID}_A, S) \rightarrow \textit{ek}_{\textit{ID}_A}(S)$}

$g \gets 1_{\mathbb{G}_1}$

$H: (\bm{u} \gets (\bm{u}_0, \bm{u}_1, \cdots, \bm{u}_n), \textit{ID} \gets (\textit{ID}_1, \textit{ID}_2, \cdots, \textit{ID}_n)) \rightarrow \bm{u}_0\prod\limits_{j \in [1, n]} \bm{u}_j^{\textit{ID}_j}$

generate $\vec{r} = (r_1, r_2, \cdots, r_n) \in \mathbb{Z}_r^n$ randomly

generate a $(d - 1)$ degree polynominal $q(x)$ s.t. $q(0) = \beta$ randomly

$\textit{ek}_{\textit{ID}_{A_i}} \gets (g_3^{q(i)} [H(\bm{u}', \textit{ID}_A)T'_i]^{r_i}, g^{r_i}), \forall i \in \{1, 2, \cdots, n\}$

generate $\textit{ek}_{\textit{ID}_A}(S) \subset \textit{ek}_{\textit{ID}_A}$ s.t. $\|\textit{ek}_{\textit{ID}_A}(S)\| = d$ randomly

\textbf{return} $\textit{ek}_{\textit{ID}_A}(S)$

\subsection{$\textbf{DKGen}(\textit{id}_B) \rightarrow \textit{dk}_{\textit{ID}_B}$}

$g \gets 1_{\mathbb{G}_1}$

$H: (\bm{u} \gets (\bm{u}_0, \bm{u}_1, \cdots, \bm{u}_n), \textit{ID} \gets (\textit{ID}_1, \textit{ID}_2, \cdots, \textit{ID}_n)) \rightarrow \bm{u}_0\prod\limits_{j \in [1, n]} \bm{u}_j^{\textit{ID}_j}$

generate $\vec{k}_1 = (k_{1, 1}, k_{1, 2}, \cdots, k_{1, n}) \in \mathbb{Z}_r^n$ randomly

generate $\vec{k}_2 = (k_{2, 1}, k_{2, 2}, \cdots, k_{2, n}) \in \mathbb{Z}_r^n$ randomly

$\textit{dk}_{\textit{ID}_{B_i}} \gets (
g^{k_{1, i} t_1 t_2 + k_{2, i} t_3 t_4}
g_2^{-\alpha t_2} [H(\bm{u}, \textit{ID}_B) T_i]^{k_{1, i} t_2}
g_2^{-\alpha t_1} [H(\bm{u}, \textit{ID}_B) T_i]^{k_{1, i} t_1}
[H(\bm{u}, \textit{ID}_B) T_i]^{k_{2, i} t_4}
[H(\bm{u}, \textit{ID}_B) T_i]^{k_{2, i} t_3}
), \forall i \in \{1, 2, \cdots, n\}
$

generate $\textit{dk}_{\textit{ID}_B}(S') \subset \textit{dk}_{\textit{ID}_B}$ s.t. $\|\textit{dk}_{\textit{ID}_B}(S')\| = d$ randomly

\textbf{return} $\textit{dk}_{\textit{ID}_B}(S')$

\subsection{$\textbf{Enc}(\textit{ek}_{\textit{ID}_A}(S), \textit{ID}_A, \textit{ID}_B, S, M) \rightarrow \textit{CT}$}

$g \gets 1_{\mathbb{G}_1}$

$H: (\bm{u} \gets (\bm{u}_0, \bm{u}_1, \cdots, \bm{u}_n), \textit{ID} \gets (\textit{ID}_1, \textit{ID}_2, \cdots, \textit{ID}_n)) \rightarrow \bm{u}_0\prod\limits_{j \in [1, n]} \bm{u}_j^{\textit{ID}_j}$

generate $S'' \subset [1, n]$ s.t. $\|S''\| = d$ randomly

generate $s \in \mathbb{Z}_r$ randomly

generate $\vec{s}_1 = (s_{1, 1}, s_{1, 2}, \cdots, s_{1, n})$ randomly

generate $\vec{s}_2 = (s_{2, 1}, s_{2, 2}, \cdots, s_{2, n})$ randomly

generate a $(d - 1)$ degree polynominal $q(x)$ s.t. $q(0) = s$ randomly

$K_s \gets Y_1^s$

$K_l \gets Y_2^s$

$C \gets M \cdot K_s \cdot K_l$

$C_{1, i} \gets [H(\bm{u}, \textit{ID}_B) T_i]^{q(i)}, \forall i \in S''$

$C_{2, i} \gets v_1^{q(i) - s_{1, i}}, \forall i \in S''$

$C_{3, i} \gets v_2^{s_{1, i}}, \forall i \in S''$

$C_{4, i} \gets v_3^{q(i) - s_{2, i}}, \forall i \in S''$

$C_{5, i} \gets v_4^{s_{2, i}}, \forall i \in S''$

generate $\vec{z} = (z_1, z_2, \cdots, z_n) \in \mathbb{Z}_r^d$ randomly

generate $\vec{z}' = (z'_1, z'_2, \cdots, z'_n) \in \mathbb{Z}_r^d$ randomly

$C_{6, i} \gets g^{z'_i}, \forall i \in S$

$C_{7, i} \gets (\textit{ek}_{\textit{ID}_{A_{i, 2}}}(S) \cdot g^{z_i})^s, \forall i \in S$

$C_{8, i} \gets \textit{ek}_{\textit{ID}_{A_{i, 1}}}(S) \cdot [H(\bm{u}', \textit{ID}_A) T'_i]^{s \cdot z_i} \cdot H_1(
C || C_{1, i} || C_{2, i} || C_{3, i}
C_{4, i} || C_{5, i} || C_{6, i} || C_{7, i}
), \forall i \in S$

$I \gets S \cap S''$

\textbf{if} $\|I\| \leqslant d$ \textbf{then}

	\quad generate $I^* \subset I$ randomly

$\textit{CT} \gets (S'', I^*, C, \vec{C}_1, \vec{C}_2, \vec{C}_3, \vec{C}_4, \vec{C}_5, \vec{C}_6, \vec{C}_7, \vec{C}_8)$

\textbf{return} $\textit{CT}$

\subsection{$\textbf{Dec}(\textit{dk}_{\textit{ID}_B}(S'), \textit{ID}_B, \textit{ID}_A, \textit{CT}) \rightarrow M$}

$\textit{CT}_i \gets C || C_{1, i} || C_{2, i} || C_{3, i} || C_{4, i} || C_{5, i} || C_{6, i} || C{7, i}, \forall i \in \{1, 2, \cdots, n\}$

$K'_l \gets \prod\limits_{i \in I^*} \left(\frac{e(C_{8, i}, g)}{e([H(\bm{u}', \textit{ID}_A) T'_i] e(H_1(\textit{CT}_i), C_{6, i})}\right)^{\Delta(i, I, 0)}$

$K'_s \gets \prod\limits_{i \in I} \left(\right)^{\Delta(i, j, 0)}$

\textbf{if} $|S \cap S'| \leqslant d \land |S' \cap S''| \leqslant d$ \textbf{then}

quad$M \gets C \cdot K'_s \cdot K'_l$

\textbf{else}

	\quad$M \gets \perp$

\textbf{end if}

\textbf{return} $M$

\end{document}